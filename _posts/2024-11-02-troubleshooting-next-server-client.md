---
title: "[Next.js] 클라이언트 컴포넌트에서 서버액션을 사용하는 것은 옳지 않다."
date: 2024-11-02
layout: single
toc: true
toc_label: "목차"
toc_icon: "align-left"
toc_sticky: true
categories:
  - troubleshooting
  - til
tags:
  - server action
  - client component
author_profile: true
sidebar_main: true
---

## :ledger: next.js에서 서버액션을 사용하는 것은 옳지 않다.

next.js를 사용한 스파르타 최종 프로젝트에서 경험한 내용입니다.

### :one: 개요

next.js의 클라이언트 컴포넌트에서 `react query`를 사용하여 서버액션 함수를 호출해서 `queryFn`에 넣어주었다. 이렇게 적용했을 때 데이터 패칭은 이루어진다. 사실 이 부분에 대해서 어색함을 못 느끼고 작업하고 있던 중 다른 이슈사항이 있어, 튜터님께 도움을 요청했고 튜터님이 문제를 확인해주며 클라이언트 컴포넌트에서 서버액션을 사용한 이유에 대해 물어보셨고 나는 대답을 할 수 없었다.

### :two: 왜 사용하면 안될까?

먼저 서버-클라이언트 실행 환경의 차이를 이해해야한다.

- 서버 액션 함수는 서버 환경에서 실행되고 클라이언트 환경에서는 `fetch`나 API 호출을 통해 서버와 통신을 해야한다.
- 클라이언트 컴포넌트는 브라우저에서 실행되기 때문에, 서버 전용 함수(예: 데이터베이스 작업이나 비공개 서버 로직)를 직접 실행할 수 없다. 브라우저는 파일 시스템, 서버리소스 등의 접근 권한이 없기 때문

#### :pushpin: 2-1) 근데 왜 데이터 패칭은 성공함?

그런데 왜 `react query`에 서버액션 함수를 `queryFn`에 넣어줬을 때 데이터 패칭은 성공하는가? 이 부분에서 이해가 되지 않되었는데, 이유는 아래와 같았다.

- `React Query`의 `queryFn`에 서버 액션 함수를 넣을 때 클라이언트에서 HTTP 요청을 통해 서버 액션을 호출하고, React Query가 그요청의 응답을 처리하기 때문에 동작하는 것임
- 하지만 서버와 클라이언트의 경계를 무너뜨릴 수 있으며, 코드가 실행할 때 예상하지 못한 문제가 생길 수 있음

#### :pushpin: 2-2) 결론

동작은 하지만, 중요한 것은 동작을 하는 것이 아니었다. <u>서버액션을 왜 사용하는가?</u>라는 부분에서 이해를 하지 않고 접근했던 것이 문제였다. 서버액션 함수를 사용하는 이유는 민감한 데이터나 서버 전용 로직이 포함될 때 사용하는데, 호출하는 곳이 클라이언트이고 성공 여부를 떠나 사용하려는 이유에서 의문을 가지게 되는것 결론은 서버액션함수를 `queryFn`으로 데이터 패칭이 성공할 수 있지만 이 방식은 서버액션을 사용하는 이유인 보안과 코드 사용성 측면에서 옳지 않다.

### :fire: 마무리

서버 액션 함수를 queryFn으로 사용해 데이터 패칭이 성공할 수 있지만, 이 방식은 보안과 코드 사용성 측면에서 적절하지 않다.

- 서버 컴포넌트에서 props를 통해 패칭된 데이터를 클라이언트 컴포넌트로 전달
- 서버액션이 아닌 route handler 사용하여 클라이언트 컴포넌트에서 데이터 패칭
